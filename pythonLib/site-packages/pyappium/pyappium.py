# -*- coding: utf-8 -*-
# !/usr/bin/env python
# __author__ = 'hongkefeng'

from pyappium.config import Platform, TaskConfig
from pyappium.report import Report
from pyappium.script_parser import TaskFlow


class Task(object):
    def __init__(self, script_fp):
        self.__platform = ""
        self.__script_fp = script_fp

        report = Report("./src/report", "report")
        if self.__script_fp.lower().endswith("android"):
            self.__platform = Platform.Android
        elif self.__script_fp.lower().endswith("ios"):
            self.__platform = Platform.IOS
        else:
            print(
                "脚本格式错误: {script_fp}, 文件名需要以android或者ios结尾".format(
                    script_fp=self.__script_fp
                )
            )
            exit()

        self.task = TaskFlow(self.__script_fp, report, self.__platform)

    @staticmethod
    def set_popup_elements(popup_elements):
        TaskConfig.android_popup_elements_json = popup_elements
        TaskConfig.ios_popup_elements_json = popup_elements

    @staticmethod
    def set_ios_device_info(ios_device_info):
        TaskConfig.IOS_Device_Info = ios_device_info

    def start(self):
        self.task.start()

    def debug(self):
        self.task.debug()
